<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Scrollable PDF Viewer with PDF.js</title>
        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            body,
            html {
                height: 100%;
                overflow: hidden;
                font-family: Arial, sans-serif;
            }
            #pdf-container {
                width: 100%;
                height: 100%;
                overflow-y: auto;
                /* Вертикальная прокрутка */
                overflow-x: hidden;
                background-color: #f0f0f0;
            }
            .pdf-page {
                display: block;
                width: 100%;
                /* Отступ между страницами */
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                background-color: #fff;
            }
            .pdf-link {
                position: absolute;
            }
        </style>
    </head>
    <body>
        <div id="pdf-container"></div>

        <script type="module">
            import * as pdfjsLib from 'https://cdn.jsdelivr.net/npm/pdfjs-dist@4.9.155/+esm';

            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@4.9.155/build/pdf.worker.mjs';

            const url = 'https://web-padawans-tent.github.io/new-year.github.io/Festive.pdf';
            const pdfContainer = document.getElementById('pdf-container');
            let pdfDoc = null;

            async function renderPDF() {
                if (!pdfDoc) {
                    pdfDoc = await pdfjsLib
                        .getDocument(url)
                        .promise;
                }

                if (!pdfDoc) 
                    return;
                
                pdfContainer.innerHTML = "";

                // Последовательный рендеринг страниц
                for (let pageNum = 1; pageNum <= pdfDoc.numPages; pageNum++) {
                    await renderPage(pageNum);
                }
            }

            async function renderPage(pageNum) {
                const page = await pdfDoc.getPage(pageNum);

                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');

                const scale = (pdfContainer.clientWidth / page.getViewport({scale: 1}).width) * window.devicePixelRatio;
                const viewport = page.getViewport({scale});

                canvas.width = viewport.width;
                canvas.height = viewport.height;
                canvas.style.width = `${viewport.width / window.devicePixelRatio}px`;
                canvas.style.height = `${viewport.height / window.devicePixelRatio}px`;

                const pageContainer = document.createElement('div');
                pageContainer.style.position = 'relative';
                pageContainer
                    .classList
                    .add('pdf-page');
                pageContainer.appendChild(canvas);

                await page
                    .render({canvasContext: context, viewport: viewport})
                    .promise;

                pdfContainer.appendChild(pageContainer);
            }

            // Дебаунс-функция для уменьшения частоты вызовов renderPDF()
            function debounce(func, delay) {
                let timeout;
                return function () {
                    clearTimeout(timeout);
                    timeout = setTimeout(func, delay);
                };
            }

            // Перерендеринг при изменении размера окна
            window.addEventListener('resize', debounce(renderPDF, 200));

            // Инициализация рендеринга
            renderPDF();
        </script>
    </body>
</html>